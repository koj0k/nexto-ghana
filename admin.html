<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nexto Admin Dashboard</1title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" href="nexto-logo.jpg" type="image/jpeg">
  <style>
    :root { --primary: #0ea5e9; --light-blue: #e0f2fe; --white: #ffffff; --gray: #6b7280; --dark: #1f2937; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--light-blue); color: var(--dark); line-height: 1.7; }
    .hero { background: linear-gradient(135deg, var(--primary), #0284c7); color: white; padding: 3rem 2rem; text-align: center; position: relative; }
    .hero .logo { position: absolute; top: 1.5rem; left: 2rem; width: 110px; height: 110px; border-radius: 50%; background: white; padding: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
    .hero h1 { font-size: 3rem; font-weight: 800; }
    .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); }
    .login-box { background: white; padding: 3rem 2.5rem; border-radius: 20px; box-shadow: 0 20px 50px rgba(14,165,233,0.15); max-width: 420px; width: 100%; text-align: center; }
    .login-box input { width: 100%; padding: 1rem; margin: 1rem 0; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1.1rem; }
    .login-box button { background: var(--primary); color: white; padding: 1rem; border: none; border-radius: 12px; width: 100%; font-size: 1.1rem; font-weight: 600; cursor: pointer; }
    .dashboard { display: none; min-height: 100vh; padding: 2rem; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 4rem; }
    .stat-card { background: white; padding: 2rem; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; }
    .stat-number { font-size: 2.8rem; font-weight: 700; color: var(--primary); }
    .chart-section { background: white; padding: 2rem; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); max-width: 500px; margin: 0 auto 4rem; }
    .table-container { background: white; border-radius: 18px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
    table { width: 100%; border-collapse: collapse; min-width: 900px; }
    th { background: var(--primary); color: white; padding: 1.5rem 1rem; text-align: left; }
    td { padding: 1.2rem 1rem; border-bottom: 1px solid #f1f5f9; }
    .status { padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.8rem; font-weight: 600; text-transform: capitalize; display: inline-block; }
    .pending { background: #fffbeb; color: #92400e; }
    .in-progress { background: #dbeafe; color: #1e40af; }
    .delivered { background: #d1fae5; color: #065f46; }
    .cancelled { background: #fee2e2; color: #991b1b; }
    .btn { padding: 0.5rem 0.9rem; border: none; border-radius: 8px; font-size: 0.8rem; font-weight: 600; cursor: pointer; }
    .btn-pending { background: #f59e0b; color: white; }
    .btn-progress { background: #3b82f6; color: white; }
    .btn-delivered { background: #10b981; color: white; }
    .btn-cancel { background: #ef4444; color: white; }
    .btn-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
  </style>
</head>
<body>

  <div id="login" class="login-container">
    <div class="login-box">
      <h2>Nexto Admin</h2>
      <p>Enter your secure password</p>
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">LOGIN</button>
    </div>
  </div>

  <div id="dashboard" class="dashboard">
    <div class="hero">
      <img src="nexto-logo.jpg" alt="Nexto" class="logo">
      <h1>Nexto Admin Panel</h1>
      <p>Real-time orders • Earnings • Delivery</p>
    </div>
    <div class="container max-w-6xl mx-auto px-4">
      <div class="stats-grid">
        <div class="stat-card"><div id="totalOrders" class="stat-number">0</div><div>Total Orders</div></div>
        <div class="stat-card"><div id="pending" class="stat-number">0</div><div>Pending</div></div>
        <div class="stat-card"><div id="inProgress" class="stat-number">0</div><div>In Progress</div></div>
        <div class="stat-card"><div id="delivered" class="stat-number">0</div><div>Delivered</div></div>
        <div class="stat-card"><div id="cancelled" class="stat-number">0</div><div>Cancelled</div></div>
        <div class="stat-card"><div id="adminEarnings" class="stat-number">GH₵0.00</div><div>Admin Earnings</div></div>
        <div class="stat-card"><div id="deliveryEarnings" class="stat-number">GH₵0.00</div><div>Rider Earnings</div></div>
      </div>
      <div class="chart-section">
        <canvas id="statusChart"></canvas>
      </div>
      <div class="table-container">
        <div style="overflow-x:auto;">
          <table>
            <thead><tr>
              <th>ID</th><th>Customer</th><th>Restaurant</th><th>Details</th><th>Address</th><th>Phone</th><th>Total</th><th>Status</th><th>Actions</th>
            </tr></thead>
            <tbody id="ordersTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API = '/api'; let token = localStorage.getItem('nextoToken') || ''; let chart = null;
    if (token) { document.getElementById('login').style.display = 'none'; document.getElementById('dashboard').style.display = 'block'; loadData(); }

    async function login() {
      const pass = document.getElementById('password').value.trim();
      if (!pass) return alert('Enter password');
      const res = await fetch(`${API}/admin/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password: pass }) });
      const data = await res.json();
      if (data.token) {
        token = data.token; localStorage.setItem('nextoToken', token);
        document.getElementById('login').style.display = 'none'; document.getElementById('dashboard').style.display = 'block'; loadData();
      } else alert('Wrong password! Use: nexto2025');
    }

    async function loadData() {
      const res = await fetch(`${API}/admin/orders`, { headers: { Authorization: `Bearer ${token}` } });
      if (!res.ok) { alert('Session expired'); localStorage.removeItem('nextoToken'); location.reload(); return; }
      const { orders, stats } = await res.json();

      document.getElementById('totalOrders').textContent = stats.totalOrders;
      document.getElementById('pending').textContent = stats.pending;
      document.getElementById('inProgress').textContent = stats.inProgress;
      document.getElementById('delivered').textContent = stats.delivered;
      document.getElementById('cancelled').textContent = stats.cancelled;
      document.getElementById('adminEarnings').textContent = `GH₵${stats.serviceEarnings || 0}.00`;
      document.getElementById('deliveryEarnings').textContent = `GH₵${stats.deliveryEarnings || 0}.00`;

      document.getElementById('ordersTable').innerHTML = orders.map(o => `
        <tr>
          <td><strong>#${o.id}</strong></td>
          <td>${o.customerName}</td>
          <td>${o.restaurant || '—'}</td>
          <td style="max-width:250px;white-space:normal;">${o.orderDetails.replace(/\|/g, '<br>')}</td>
          <td>${o.deliveryAddress}</td>
          <td>${o.phone}</td>
          <td><strong>GH₵${o.cartTotal.toFixed(2)}</strong></td>
          <td><span class="status ${o.status.replace(/-/g,'')}">${o.status.replace(/-/g,' ')}</span></td>
          <td><div class="btn-group">
            <button class="btn btn-pending" onclick="setStatus('${o.id}','pending')">Pending</button>
            <button class="btn btn-progress" onclick="setStatus('${o.id}','in-progress')">Progress</button>
            <button class="btn btn-delivered" onclick="setStatus('${o.id}','delivered')">Delivered</button>
            <button class="btn btn-cancel" onclick="setStatus('${o.id}','cancelled')">Cancel</button>
          </div></td>
        </tr>
      `).join('');

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('statusChart'), {
        type: 'doughnut',
        data: { labels: ['Pending','In Progress','Delivered','Cancelled'], datasets: [{ data: [stats.pending, stats.inProgress, stats.delivered, stats.cancelled], backgroundColor: ['#f59e0b','#3b82f6','#10b981','#ef4444'] }] },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
      });
    }

    async function setStatus(id, status) {
      await fetch(`${API}/orders/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` }, body: JSON.stringify({ status }) });
      loadData();
    }

    setInterval(() => { if (token) loadData(); }, 10000);
  </script>
</body>
</html>
